{"version":3,"file":"local.strategy.js","sourceRoot":"","sources":["../../../../libs/rucken/auth-nestjs/src/passport/local.strategy.ts"],"names":[],"mappings":";;;AAAA,2CAA4C;AAC5C,+CAAoD;AAEpD,mDAA0C;AAC1C,2DAAuD;AAGvD,IAAa,mBAAmB,GAAhC,MAAa,mBAAoB,SAAQ,2BAAgB,CAAC,yBAAQ,EAAE,QAAQ,CAAC;IAC3E,YAA6B,WAAwB;QACnD,KAAK,CAAC;YACJ,aAAa,EAAE,OAAO;YACtB,aAAa,EAAE,UAAU;YACzB,iBAAiB,EAAE,IAAI;SACxB,CAAC,CAAC;QALwB,gBAAW,GAAX,WAAW,CAAa;IAMrD,CAAC;IAEY,QAAQ,CAAC,GAAG,EAAE,KAAa,EAAE,QAAgB;;YACxD,MAAM,EAAE,IAAI,EAAE,GAAmB,MAAM,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC,EAAE,KAAK,EAAE,QAAQ,EAAE,CAAC,CAAC;YACpF,OAAO,IAAI,CAAC;QACd,CAAC;KAAA;CACF,CAAA;AAbY,mBAAmB;IAD/B,mBAAU,EAAE;6CAE+B,0BAAW;GAD1C,mBAAmB,CAa/B;AAbY,kDAAmB;AAgBhC,IAAa,mBAAmB,GAAhC,MAAa,mBAAoB,SAAQ,2BAAgB,CAAC,yBAAQ,EAAE,QAAQ,CAAC;IAC3E,YAA6B,WAAwB;QACnD,KAAK,CAAC;YACJ,aAAa,EAAE,OAAO;YACtB,aAAa,EAAE,UAAU;YACzB,iBAAiB,EAAE,IAAI;SACxB,CAAC,CAAC;QALwB,gBAAW,GAAX,WAAW,CAAa;IAMrD,CAAC;IAEY,QAAQ,CAAC,GAAG,EAAE,KAAa,EAAE,QAAgB;;YACxD,IAAI,GAAG,CAAC,IAAI,EAAE;gBACZ,OAAO,GAAG,CAAC,IAAI,CAAC;aACjB;YACD,MAAM,EAAE,IAAI,EAAE,GAAG,MAAM,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC;gBAC7C,KAAK;gBACL,QAAQ;gBACR,QAAQ,EAAE,GAAG,CAAC,IAAI,CAAC,QAAQ;aAC5B,CAAC,CAAC;YACH,OAAO,IAAI,CAAC;QACd,CAAC;KAAA;CACF,CAAA;AApBY,mBAAmB;IAD/B,mBAAU,EAAE;6CAE+B,0BAAW;GAD1C,mBAAmB,CAoB/B;AApBY,kDAAmB","sourcesContent":["import { Injectable } from '@nestjs/common';\nimport { PassportStrategy } from '@nestjs/passport';\nimport { User } from '@rucken/core-nestjs';\nimport { Strategy } from 'passport-local';\nimport { AuthService } from '../services/auth.service';\n\n@Injectable()\nexport class LocalStrategySignIn extends PassportStrategy(Strategy, 'signin') {\n  constructor(private readonly authService: AuthService) {\n    super({\n      usernameField: 'email',\n      passwordField: 'password',\n      passReqToCallback: true\n    });\n  }\n\n  public async validate(req, email: string, password: string) {\n    const { user }: { user: User } = await this.authService.signIn({ email, password });\n    return user;\n  }\n}\n// tslint:disable-next-line:max-classes-per-file\n@Injectable()\nexport class LocalStrategySignUp extends PassportStrategy(Strategy, 'signup') {\n  constructor(private readonly authService: AuthService) {\n    super({\n      usernameField: 'email',\n      passwordField: 'password',\n      passReqToCallback: true\n    });\n  }\n\n  public async validate(req, email: string, password: string) {\n    if (req.user) {\n      return req.user;\n    }\n    const { user } = await this.authService.signUp({\n      email,\n      password,\n      username: req.body.username\n    });\n    return user;\n  }\n}\n"]}
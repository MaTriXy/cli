{"version":3,"file":"auth.module.js","sourceRoot":"","sources":["../../../libs/rucken/auth-nestjs/src/auth.module.ts"],"names":[],"mappings":";;;;AAAA,2CAA6G;AAC7G,6CAAgD;AAChD,qDAAuD;AACvD,uCAAwC;AACxC,+CAAiD;AACjD,yCAA2C;AAC3C,yCAA2C;AAG3C,IAAa,gBAAgB,wBAA7B,MAAa,gBAAgB;IAC3B,MAAM,CAAC,UAAU,CAAC,OAAmC;QACnD,MAAM,SAAS,GAAG,OAAO,IAAI,OAAO,CAAC,SAAS,CAAC,CAAC,CAAC,OAAO,CAAC,SAAS,CAAC,CAAC,CAAC,EAAE,CAAC;QACxE,OAAO;YACL,MAAM,EAAE,kBAAgB;YACxB,OAAO,EAAE,CAAC,mBAAU,EAAE,8BAAgB,CAAC,UAAU,CAAC,OAAO,CAAC,EAAE,uBAAa,CAAC,UAAU,CAAC,CAAC,GAAG,wBAAa,CAAC,CAAC,CAAC;YACzG,SAAS,EAAE,CAAC,GAAG,SAAS,EAAE,GAAG,wBAAa,CAAC;YAC3C,OAAO,EAAE,CAAC,GAAG,wBAAa,CAAC;SAC5B,CAAC;IACJ,CAAC;IACD,MAAM,CAAC,OAAO,CAAC,OAAmC;QAChD,MAAM,SAAS,GAAG,OAAO,IAAI,OAAO,CAAC,SAAS,CAAC,CAAC,CAAC,OAAO,CAAC,SAAS,CAAC,CAAC,CAAC,EAAE,CAAC;QACxE,OAAO;YACL,MAAM,EAAE,kBAAgB;YACxB,OAAO,EAAE,CAAC,mBAAU,EAAE,8BAAgB,CAAC,UAAU,CAAC,OAAO,CAAC,EAAE,uBAAa,CAAC,UAAU,CAAC,CAAC,GAAG,wBAAa,CAAC,CAAC,CAAC;YACzG,WAAW,EAAE,CAAC,GAAG,8BAAgB,CAAC;YAClC,SAAS,EAAE,CAAC,GAAG,SAAS,EAAE,GAAG,wBAAa,CAAC;YAC3C,OAAO,EAAE,CAAC,GAAG,wBAAa,CAAC;SAC5B,CAAC;IACJ,CAAC;IAEM,SAAS,CAAC,QAA4B;QAC3C,QAAQ,CAAC,KAAK,CAAC,uBAAY,CAAC,QAAQ,EAAE,EAAE,OAAO,EAAE,KAAK,EAAE,iBAAiB,EAAE,IAAI,EAAE,CAAC,CAAC,CAAC,SAAS,CAAC,iBAAiB,CAAC,CAAC;QACjH,QAAQ,CAAC,KAAK,CAAC,uBAAY,CAAC,QAAQ,EAAE,EAAE,OAAO,EAAE,KAAK,EAAE,iBAAiB,EAAE,IAAI,EAAE,CAAC,CAAC,CAAC,SAAS,CAAC,iBAAiB,CAAC,CAAC;QACjH,QAAQ;aACL,KAAK,CAAC,uBAAY,CAAC,UAAU,EAAE,EAAE,OAAO,EAAE,KAAK,EAAE,iBAAiB,EAAE,IAAI,EAAE,CAAC,CAAC;aAC5E,SAAS,CAAC,yBAAyB,CAAC,CAAC;QACxC,QAAQ;aACL,KAAK,CAAC,uBAAY,CAAC,QAAQ,EAAE,EAAE,OAAO,EAAE,KAAK,EAAE,iBAAiB,EAAE,IAAI,EAAE,CAAC,CAAC;aAC1E,SAAS,CAAC,4BAA4B,CAAC,CAAC;IAC7C,CAAC;CACF,CAAA;AA/BY,gBAAgB;IAD5B,eAAM,CAAC,EAAE,CAAC;GACE,gBAAgB,CA+B5B;AA/BY,4CAAgB","sourcesContent":["import { DynamicModule, HttpModule, MiddlewareConsumer, Module, NestModule, Provider } from '@nestjs/common';\nimport { TypeOrmModule } from '@nestjs/typeorm';\nimport { RuckenCoreModule } from '@rucken/core-nestjs';\nimport { authenticate } from 'passport';\nimport { AUTH_CONTROLLERS } from './controllers';\nimport { AUTH_ENTITIES } from './entities';\nimport { AUTH_SERVICES } from './services';\n\n@Module({})\nexport class RuckenAuthModule implements NestModule {\n  static forFeature(options?: { providers: Provider[] }): DynamicModule {\n    const providers = options && options.providers ? options.providers : [];\n    return {\n      module: RuckenAuthModule,\n      imports: [HttpModule, RuckenCoreModule.forFeature(options), TypeOrmModule.forFeature([...AUTH_ENTITIES])],\n      providers: [...providers, ...AUTH_SERVICES],\n      exports: [...AUTH_SERVICES]\n    };\n  }\n  static forRoot(options?: { providers: Provider[] }): DynamicModule {\n    const providers = options && options.providers ? options.providers : [];\n    return {\n      module: RuckenAuthModule,\n      imports: [HttpModule, RuckenCoreModule.forFeature(options), TypeOrmModule.forFeature([...AUTH_ENTITIES])],\n      controllers: [...AUTH_CONTROLLERS],\n      providers: [...providers, ...AUTH_SERVICES],\n      exports: [...AUTH_SERVICES]\n    };\n  }\n\n  public configure(consumer: MiddlewareConsumer) {\n    consumer.apply(authenticate('signup', { session: false, passReqToCallback: true })).forRoutes('api/auth/signup');\n    consumer.apply(authenticate('signin', { session: false, passReqToCallback: true })).forRoutes('api/auth/signin');\n    consumer\n      .apply(authenticate('facebook', { session: false, passReqToCallback: true }))\n      .forRoutes('api/auth/facebook/token');\n    consumer\n      .apply(authenticate('google', { session: false, passReqToCallback: true }))\n      .forRoutes('api/auth/google-plus/token');\n  }\n}\n"]}
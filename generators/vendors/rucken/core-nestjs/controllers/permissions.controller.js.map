{"version":3,"file":"permissions.controller.js","sourceRoot":"","sources":["../../../../libs/rucken/core-nestjs/src/controllers/permissions.controller.ts"],"names":[],"mappings":"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","sourcesContent":["import {\n  Body,\n  Controller,\n  Delete,\n  Get,\n  HttpCode,\n  HttpStatus,\n  Inject,\n  MethodNotAllowedException,\n  Param,\n  ParseIntPipe,\n  Post,\n  Put,\n  Query\n} from '@nestjs/common';\nimport { ApiBearerAuth, ApiImplicitParam, ApiImplicitQuery, ApiResponse, ApiUseTags } from '@nestjs/swagger';\nimport { plainToClass } from 'class-transformer';\nimport { CORE_CONFIG_TOKEN } from '../configs/core.config';\nimport { Permissions } from '../decorators/permissions.decorator';\nimport { Roles } from '../decorators/roles.decorator';\nimport { InPermissionDto } from '../dto/in-permission.dto';\nimport { OutPermissionDto } from '../dto/out-permission.dto';\nimport { OutPermissionsDto } from '../dto/out-permissions.dto';\nimport { Permission } from '../entities/permission.entity';\nimport { ICoreConfig } from '../interfaces/core-config.interface';\nimport { ParseIntWithDefaultPipe } from '../pipes/parse-int-with-default.pipe';\nimport { PermissionsService } from '../services/permissions.service';\n\n@ApiUseTags('permissions')\n@ApiBearerAuth()\n@Controller('/api/permissions')\nexport class PermissionsController {\n  constructor(\n    @Inject(CORE_CONFIG_TOKEN) private readonly coreConfig: ICoreConfig,\n    private readonly service: PermissionsService\n  ) {}\n\n  @Roles('isSuperuser')\n  @Permissions('add_permission')\n  @HttpCode(HttpStatus.CREATED)\n  @ApiResponse({\n    status: HttpStatus.CREATED,\n    type: OutPermissionDto,\n    description: 'The record has been successfully created.'\n  })\n  @ApiResponse({ status: HttpStatus.FORBIDDEN, description: 'Forbidden.' })\n  @Post()\n  async create(@Body() dto: InPermissionDto) {\n    try {\n      return plainToClass(\n        OutPermissionDto,\n        await this.service.create({\n          item: plainToClass(Permission, dto)\n        })\n      );\n    } catch (error) {\n      throw error;\n    }\n  }\n\n  @Roles('isSuperuser')\n  @Permissions('change_permission')\n  @HttpCode(HttpStatus.OK)\n  @ApiResponse({\n    status: HttpStatus.OK,\n    type: OutPermissionDto,\n    description: 'The record has been successfully updated.'\n  })\n  @ApiResponse({ status: HttpStatus.FORBIDDEN, description: 'Forbidden.' })\n  @ApiImplicitParam({ name: 'id', type: Number })\n  @Put(':id')\n  async update(@Param('id', new ParseIntPipe()) id, @Body() dto: InPermissionDto) {\n    if (this.coreConfig.demo) {\n      throw new MethodNotAllowedException('Not allowed in DEMO mode');\n    }\n    try {\n      return plainToClass(\n        OutPermissionDto,\n        await this.service.update({\n          id,\n          item: plainToClass(Permission, dto)\n        })\n      );\n    } catch (error) {\n      throw error;\n    }\n  }\n\n  @Roles('isSuperuser')\n  @Permissions('delete_permission')\n  @HttpCode(HttpStatus.NO_CONTENT)\n  @ApiResponse({\n    status: HttpStatus.NO_CONTENT,\n    description: 'The record has been successfully deleted.'\n  })\n  @ApiResponse({ status: HttpStatus.FORBIDDEN, description: 'Forbidden.' })\n  @ApiImplicitParam({ name: 'id', type: Number })\n  @Delete(':id')\n  async delete(@Param('id', new ParseIntPipe()) id) {\n    if (this.coreConfig.demo) {\n      throw new MethodNotAllowedException('Not allowed in DEMO mode');\n    }\n    try {\n      return plainToClass(\n        OutPermissionDto,\n        await this.service.delete({\n          id\n        })\n      );\n    } catch (error) {\n      throw error;\n    }\n  }\n\n  @Roles('isSuperuser')\n  @Permissions('read_permission')\n  @HttpCode(HttpStatus.OK)\n  @ApiResponse({\n    status: HttpStatus.OK,\n    type: OutPermissionDto,\n    description: ''\n  })\n  @ApiResponse({ status: HttpStatus.FORBIDDEN, description: 'Forbidden.' })\n  @ApiImplicitParam({ name: 'id', type: Number })\n  @Get(':id')\n  async findById(@Param('id', new ParseIntPipe()) id) {\n    try {\n      return plainToClass(\n        OutPermissionDto,\n        await this.service.findById({\n          id\n        })\n      );\n    } catch (error) {\n      throw error;\n    }\n  }\n\n  @Roles('isSuperuser')\n  @Permissions('read_permission')\n  @HttpCode(HttpStatus.OK)\n  @ApiResponse({\n    status: HttpStatus.OK,\n    type: OutPermissionsDto,\n    description: ''\n  })\n  @ApiResponse({ status: HttpStatus.FORBIDDEN, description: 'Forbidden.' })\n  @ApiImplicitQuery({\n    name: 'q',\n    required: false,\n    type: String,\n    description: 'Text for search (default: empty)'\n  })\n  @ApiImplicitQuery({\n    name: 'sort',\n    required: false,\n    type: String,\n    description: 'Column name for sort (default: -id)'\n  })\n  @ApiImplicitQuery({\n    name: 'per_page',\n    required: false,\n    type: Number,\n    description: 'Number of results to return per page. (default: 10)'\n  })\n  @ApiImplicitQuery({\n    name: 'cur_page',\n    required: false,\n    type: Number,\n    description: 'A page number within the paginated result set. (default: 1)'\n  })\n  @ApiImplicitQuery({\n    name: 'group',\n    required: false,\n    type: Number,\n    description: 'Group id for filter data by group. (default: empty)'\n  })\n  @ApiImplicitQuery({\n    name: 'content_type',\n    required: false,\n    type: Number,\n    description: 'Content type id for filter data by content type. (default: empty)'\n  })\n  @Get()\n  async findAll(\n    @Query('cur_page', new ParseIntWithDefaultPipe(1)) curPage,\n    @Query('per_page', new ParseIntWithDefaultPipe(10)) perPage,\n    @Query('q') q,\n    @Query('group') group,\n    @Query('content_type') contentType,\n    @Query('sort') sort\n  ) {\n    try {\n      return plainToClass(\n        OutPermissionsDto,\n        await this.service.findAll({\n          curPage,\n          perPage,\n          q,\n          sort,\n          group,\n          contentType\n        })\n      );\n    } catch (error) {\n      throw error;\n    }\n  }\n}\n"]}
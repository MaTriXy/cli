{"version":3,"file":"groups.controller.js","sourceRoot":"","sources":["../../../../libs/rucken/core-nestjs/src/controllers/groups.controller.ts"],"names":[],"mappings":"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","sourcesContent":["import {\n  Body,\n  Controller,\n  Delete,\n  Get,\n  HttpCode,\n  HttpStatus,\n  Inject,\n  MethodNotAllowedException,\n  Param,\n  ParseIntPipe,\n  Post,\n  Put,\n  Query\n} from '@nestjs/common';\nimport { ApiBearerAuth, ApiImplicitParam, ApiImplicitQuery, ApiResponse, ApiUseTags } from '@nestjs/swagger';\nimport { plainToClass } from 'class-transformer';\nimport { CORE_CONFIG_TOKEN } from '../configs/core.config';\nimport { Permissions } from '../decorators/permissions.decorator';\nimport { Roles } from '../decorators/roles.decorator';\nimport { InGroupDto } from '../dto/in-group.dto';\nimport { OutGroupDto } from '../dto/out-group.dto';\nimport { OutGroupsDto } from '../dto/out-groups.dto';\nimport { Group } from '../entities/group.entity';\nimport { ICoreConfig } from '../interfaces/core-config.interface';\nimport { ParseIntWithDefaultPipe } from '../pipes/parse-int-with-default.pipe';\nimport { GroupsService } from '../services/groups.service';\n\n@ApiUseTags('groups')\n@ApiBearerAuth()\n@Controller('/api/groups')\nexport class GroupsController {\n  constructor(\n    @Inject(CORE_CONFIG_TOKEN) private readonly coreConfig: ICoreConfig,\n    private readonly service: GroupsService\n  ) {}\n\n  @Roles('isSuperuser')\n  @Permissions('add_group')\n  @HttpCode(HttpStatus.CREATED)\n  @ApiResponse({\n    status: HttpStatus.CREATED,\n    type: OutGroupDto,\n    description: 'The record has been successfully created.'\n  })\n  @ApiResponse({ status: HttpStatus.FORBIDDEN, description: 'Forbidden.' })\n  @Post()\n  async create(@Body() dto: InGroupDto) {\n    try {\n      return plainToClass(\n        OutGroupDto,\n        await this.service.create({\n          item: plainToClass(Group, dto)\n        })\n      );\n    } catch (error) {\n      throw error;\n    }\n  }\n\n  @Roles('isSuperuser')\n  @Permissions('change_group')\n  @HttpCode(HttpStatus.OK)\n  @ApiResponse({\n    status: HttpStatus.OK,\n    type: OutGroupDto,\n    description: 'The record has been successfully updated.'\n  })\n  @ApiResponse({ status: HttpStatus.FORBIDDEN, description: 'Forbidden.' })\n  @ApiImplicitParam({ name: 'id', type: Number })\n  @Put(':id')\n  async update(@Param('id', new ParseIntPipe()) id, @Body() dto: InGroupDto) {\n    if (this.coreConfig.demo) {\n      throw new MethodNotAllowedException('Not allowed in DEMO mode');\n    }\n    try {\n      return plainToClass(\n        OutGroupDto,\n        await this.service.update({\n          id,\n          item: plainToClass(Group, dto)\n        })\n      );\n    } catch (error) {\n      throw error;\n    }\n  }\n\n  @Roles('isSuperuser')\n  @Permissions('delete_group')\n  @HttpCode(HttpStatus.NO_CONTENT)\n  @ApiResponse({\n    status: HttpStatus.NO_CONTENT,\n    description: 'The record has been successfully deleted.'\n  })\n  @ApiResponse({ status: HttpStatus.FORBIDDEN, description: 'Forbidden.' })\n  @ApiImplicitParam({ name: 'id', type: Number })\n  @Delete(':id')\n  async delete(@Param('id', new ParseIntPipe()) id) {\n    if (this.coreConfig.demo) {\n      throw new MethodNotAllowedException('Not allowed in DEMO mode');\n    }\n    try {\n      return plainToClass(\n        OutGroupDto,\n        await this.service.delete({\n          id\n        })\n      );\n    } catch (error) {\n      throw error;\n    }\n  }\n\n  @Roles('isSuperuser')\n  @Permissions('read_group')\n  @HttpCode(HttpStatus.OK)\n  @ApiResponse({\n    status: HttpStatus.OK,\n    type: OutGroupDto,\n    description: ''\n  })\n  @ApiResponse({ status: HttpStatus.FORBIDDEN, description: 'Forbidden.' })\n  @ApiImplicitParam({ name: 'id', type: Number })\n  @Get(':id')\n  async findById(@Param('id', new ParseIntPipe()) id) {\n    try {\n      return plainToClass(\n        OutGroupDto,\n        await this.service.findById({\n          id\n        })\n      );\n    } catch (error) {\n      throw error;\n    }\n  }\n\n  @Roles('isSuperuser')\n  @Permissions('read_group')\n  @HttpCode(HttpStatus.OK)\n  @ApiResponse({\n    status: HttpStatus.OK,\n    type: OutGroupsDto,\n    description: ''\n  })\n  @ApiResponse({ status: HttpStatus.FORBIDDEN, description: 'Forbidden.' })\n  @ApiImplicitQuery({\n    name: 'q',\n    required: false,\n    type: String,\n    description: 'Text for search (default: empty)'\n  })\n  @ApiImplicitQuery({\n    name: 'sort',\n    required: false,\n    type: String,\n    description: 'Column name for sort (default: -id)'\n  })\n  @ApiImplicitQuery({\n    name: 'per_page',\n    required: false,\n    type: Number,\n    description: 'Number of results to return per page. (default: 10)'\n  })\n  @ApiImplicitQuery({\n    name: 'cur_page',\n    required: false,\n    type: Number,\n    description: 'A page number within the paginated result set. (default: 1)'\n  })\n  @Get()\n  async findAll(\n    @Query('cur_page', new ParseIntWithDefaultPipe(1)) curPage,\n    @Query('per_page', new ParseIntWithDefaultPipe(10)) perPage,\n    @Query('q') q,\n    @Query('sort') sort\n  ) {\n    try {\n      return plainToClass(\n        OutGroupsDto,\n        await this.service.findAll({\n          curPage,\n          perPage,\n          q,\n          sort\n        })\n      );\n    } catch (error) {\n      throw error;\n    }\n  }\n}\n"]}
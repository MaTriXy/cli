{"version":3,"file":"config.js","sourceRoot":"","sources":["../../../../apps/custom-app-nestjs/src/app/config/config.ts"],"names":[],"mappings":"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","sourcesContent":["import { Logger } from \"@nestjs/common\";\nimport {\n  AUTH_APP_FILTERS,\n  AUTH_APP_GUARDS,\n  AUTH_PASSPORT_STRATAGIES,\n  DEFAULT_FACEBOOK_CONFIG,\n  DEFAULT_GOOGLE_PLUS_CONFIG,\n  DEFAULT_JWT_CONFIG,\n  FACEBOOK_CONFIG_TOKEN,\n  GOOGLE_PLUS_CONFIG_TOKEN,\n  JWT_CONFIG_TOKEN\n} from \"@rucken/auth-nestjs\";\nimport {\n  CORE_APP_FILTERS,\n  CORE_APP_PIPES,\n  CORE_CONFIG_TOKEN,\n  DEFAULT_CORE_CONFIG\n} from \"@rucken/core-nestjs\";\nimport { ConnectionString } from \"connection-string\";\nimport { load } from \"dotenv\";\nimport { accessSync, readFileSync } from \"fs\";\nimport * as path from \"path\";\nimport { ICustomAppNestjsConfig } from \"./config.interface\";\n\nconst NODE_ENV = process.env.NODE_ENV || \"develop\";\nconst envFile = resolveRootFile(`${NODE_ENV}.env`);\nconst connectionString = new ConnectionString(\n  process.env.DATABASE_URL || \"sqlite://database/sqlitedb.db\"\n);\nconst dbFile =\n  connectionString.protocol === \"sqlite\"\n    ? \"./\" +\n      (connectionString.hosts ? connectionString.hosts[0].name : \"\") +\n      (connectionString.path ? \"/\" + connectionString.path[0] : \"\")\n    : \"\";\ntry {\n  accessSync(envFile);\n  load({ path: envFile });\n  Logger.log(`env file: ${envFile}`, \"Main\");\n} catch (error) {\n  Logger.log(`error on get env file: ${envFile}`, \"Main\");\n  try {\n    accessSync(`.env`);\n    load();\n    Logger.log(`env file: .env`, \"Main\");\n  } catch (error) {\n    Logger.log(`error on get env file: .env`, \"Main\");\n  }\n}\n\nexport const config: ICustomAppNestjsConfig = {\n  env: {\n    name: NODE_ENV,\n    port: process.env.PORT ? +process.env.PORT : 3000,\n    protocol: process.env.PROTOCOL === \"https\" ? \"https\" : \"http\"\n  },\n  project: {\n    path: getRootPath(),\n    tsconfig: loadRootJson(\"tsconfig.json\"),\n    package: loadRootJson(\"package.json\"),\n    staticFolders: [resolveRootFile(\"client\")]\n  },\n  db: {\n    connectionString: connectionString,\n    file: dbFile\n  },\n  core: {\n    providers: () => [\n      {\n        provide: CORE_CONFIG_TOKEN,\n        useValue: {\n          ...DEFAULT_CORE_CONFIG,\n          demo: process.env.DEMO === \"true\",\n          port: process.env.PORT ? +process.env.PORT : 3000,\n          protocol: process.env.PROTOCOL === \"https\" ? \"https\" : \"http\",\n          externalPort: process.env.EXTERNAL_PORT\n            ? +process.env.EXTERNAL_PORT\n            : undefined,\n          domain: process.env.DOMAIN || \"\"\n        }\n      },\n      ...CORE_APP_FILTERS,\n      ...CORE_APP_PIPES\n    ]\n  },\n  auth: {\n    providers: () => [\n      {\n        provide: JWT_CONFIG_TOKEN,\n        useValue: {\n          ...DEFAULT_JWT_CONFIG,\n          authHeaderPrefix: process.env.JWT_AUTH_HEADER_PREFIX || \"JWT\",\n          expirationDelta: process.env.JWT_EXPIRATION_DELTA || \"7 days\",\n          secretKey: process.env.JWT_SECRET_KEY || \"secret_key\"\n        }\n      },\n      {\n        provide: FACEBOOK_CONFIG_TOKEN,\n        useValue: {\n          ...DEFAULT_FACEBOOK_CONFIG,\n          client_id: process.env.FACEBOOK_CLIENT_ID || \"none\",\n          client_secret: process.env.FACEBOOK_CLIENT_SECRET || \"none\",\n          oauth_redirect_uri: process.env.FACEBOOK_OAUTH_REDIRECT_URI || \"none\"\n        }\n      },\n      {\n        provide: GOOGLE_PLUS_CONFIG_TOKEN,\n        useValue: {\n          ...DEFAULT_GOOGLE_PLUS_CONFIG,\n          client_id: process.env.GOOGLE_CLIENT_ID || \"none\",\n          client_secret: process.env.GOOGLE_CLIENT_SECRET || \"none\",\n          oauth_redirect_uri: process.env.GOOGLE_OAUTH_REDIRECT_URI || \"none\"\n        }\n      },\n      ...AUTH_APP_GUARDS,\n      ...AUTH_APP_FILTERS\n    ],\n    passportProviders: () => AUTH_PASSPORT_STRATAGIES\n  }\n};\nexport function getRootPath() {\n  return NODE_ENV === \"develop\" ? \"../../../../../\" : \"../../../../\";\n}\nexport function resolveRootFile(fileName: string) {\n  return path.resolve(__dirname, getRootPath(), fileName);\n}\nexport function loadRootJson<T = any>(fileName: string) {\n  return JSON.parse(readFileSync(resolveRootFile(fileName)).toString()) as T;\n}\n"]}
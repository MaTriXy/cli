!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("ngx-repository"),require("@custom-org/custom-lib"),require("bind-observable"),require("class-transformer"),require("@angular/router"),require("@angular/common"),require("@angular/core"),require("@angular/forms"),require("@ionic/angular"),require("@ngx-translate/core"),require("@rucken/core"),require("@rucken/ionic"),require("ngx-bind-io")):"function"==typeof define&&define.amd?define("@custom-org/custom-lib-ionic",["exports","ngx-repository","@custom-org/custom-lib","bind-observable","class-transformer","@angular/router","@angular/common","@angular/core","@angular/forms","@ionic/angular","@ngx-translate/core","@rucken/core","@rucken/ionic","ngx-bind-io"],e):e((t["custom-org"]=t["custom-org"]||{},t["custom-org"]["custom-lib-ionic"]={}),t.ngxRepository,t.customLib,t.bindObservable,t.classTransformer,t.ng.router,t.ng.common,t.ng.core,t.ng.forms,t.angular,t.core$1,t.core$2,t.ionic,t.ngxBindIo)}(this,function(t,e,a,o,r,n,i,s,l,u,c,d,p,m){"use strict";var f={},y={title:d.translate("Russian"),code:"ru",translations:[f]},g={title:d.translate("English"),code:"en",translations:[]},h=(C.decorators=[{type:s.NgModule,args:[{imports:[i.CommonModule],providers:[{provide:d.LANGUAGES_ITEM_CONFIG_TOKEN,useValue:y,multi:!0},{provide:d.LANGUAGES_ITEM_CONFIG_TOKEN,useValue:g,multi:!0}]}]}],C);function C(){}var I=function(t,e){return(I=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(t,e)};function M(t,e){function o(){this.constructor=t}I(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}var v=function(){return(v=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var r in e=arguments[o])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)};function b(t,e,o,n){var r,i=arguments.length,s=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,n);else for(var a=t.length-1;0<=a;a--)(r=t[a])&&(s=(i<3?r(s):3<i?r(e,o,s):r(e,o))||s);return 3<i&&s&&Object.defineProperty(e,o,s),s}function T(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)}function F(e,s,a,l){return new(a||(a=Promise))(function(t,o){function n(t){try{i(l.next(t))}catch(e){o(e)}}function r(t){try{i(l["throw"](t))}catch(e){o(e)}}function i(e){e.done?t(e.value):new a(function(t){t(e.value)}).then(n,r)}i((l=l.apply(e,s||[])).next())})}function O(n,r){var i,s,a,t,l={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return t={next:e(0),"throw":e(1),"return":e(2)},"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function o(t){if(i)throw new TypeError("Generator is already executing.");for(;l;)try{if(i=1,s&&(a=2&t[0]?s["return"]:t[0]?s["throw"]||((a=s["return"])&&a.call(s),0):s.next)&&!(a=a.call(s,t[1])).done)return a;switch(s=0,a&&(t=[2&t[0],a.value]),t[0]){case 0:case 1:a=t;break;case 4:return l.label++,{value:t[1],done:!1};case 5:l.label++,s=t[1],t=[0];continue;case 7:t=l.ops.pop(),l.trys.pop();continue;default:if(!(a=0<(a=l.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){l=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){l.label=t[1];break}if(6===t[0]&&l.label<a[1]){l.label=a[1],a=t;break}if(a&&l.label<a[2]){l.label=a[2],l.ops.push(t);break}a[2]&&l.ops.pop(),l.trys.pop();continue}t=r.call(n,l)}catch(e){t=[6,e],s=0}finally{i=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([e,t])}}}var E,S=(M(_,E=d.BasePromptFormModalComponent),_.decorators=[{type:s.Component,args:[{selector:"custom-entity-modal",template:'<prompt-form-modal\n  [bindIO]\n  [iconTopYes]="data.id ? \'checkmark\' : \'add\'"\n  [hideFooter]="true"\n>\n</prompt-form-modal>\n<ion-content padding-top [class.readonly_content]="readonly">\n  <prompt-form-modal [bindIO] [hideHeader]="true">\n    <form [formGroup]="form" novalidate>\n      <form-group [bindIO] name="title" [title]="strings.title">\n        <ion-input\n          formControlName="title"\n          [disableControl]="readonly"\n          [autofocus]="true"\n        >\n        </ion-input>\n      </form-group>\n      <form-group [bindIO] name="name" [title]="strings.name">\n        <ion-textarea formControlName="name" [disableControl]="readonly">\n        </ion-textarea>\n      </form-group>\n    </form>\n  </prompt-form-modal>\n</ion-content>\n',changeDetection:s.ChangeDetectionStrategy.OnPush}]}],_.ctorParameters=function(){return[]},_.propDecorators={"class":[{type:s.Input}]},_=b([m.BindIoInner(),T("design:paramtypes",[])],_));function _(){var t=E.call(this)||this;return t["class"]=undefined,t.group(a.CustomEntity),t}var N=(k.strings={sortField:d.translate("Sort field"),sortType:d.translate("Sort type")},k.sortFields=[{id:"id",title:d.translate("Id")},{id:"title",title:d.translate("Title")}],k.sortTypes=[{id:"asc",title:d.translate("Asc")},{id:"desc",title:d.translate("Desc")}],b([r.Type(d.serializeModel(p.SelectInput)),r.Transform(p.keyToSelectInput({items:k.sortFields}),{toClassOnly:!0,groups:["manual"]}),r.Transform(p.selectInputToKey({items:k.sortFields}),{toPlainOnly:!0,groups:["manual"]}),T("design:type",p.SelectInput)],k.prototype,"sortField",void 0),b([r.Type(d.serializeModel(p.SelectInput)),r.Transform(p.keyToSelectInput({items:k.sortTypes}),{toClassOnly:!0,groups:["manual"]}),r.Transform(p.selectInputToKey({items:k.sortTypes}),{toPlainOnly:!0,groups:["manual"]}),T("design:type",p.SelectInput)],k.prototype,"sortType",void 0),k);function k(){this.id=undefined,this.sortField=undefined,this.sortType=undefined}var x={sortField:"id",sortType:"desc"},L="CustomEntitiesListFiltersModalConfig";var w=(P.prototype.getDefault=function(){return r.plainToClass(N,v({},x,this._customEntitiesListFiltersModalConfig),{groups:["manual"]})},P.prototype.getCurrent=function(){return this.current},P.prototype.setCurrent=function(e){var o=this;this._storage.setItem(this.storageKeyName,JSON.stringify(r.classToPlain(e||this.getDefault(),{groups:["manual"]}))).then(function(t){return o.current=e})},P.prototype.initCurrent=function(){var n=this;return new Promise(function(o){n._storage.getItem(n.storageKeyName).then(function(t){if(t&&"undefined"!==t)try{o(r.plainToClass(N,JSON.parse(t),{groups:["manual"]}))}catch(e){o(n.getCurrent())}else o(n.getCurrent())})})},P.prototype.initializeApp=function(){var o=this;return new Promise(function(e){o.initCurrent().then(function(t){o.setCurrent(t),e()})})},P.decorators=[{type:s.Injectable}],P.ctorParameters=function(){return[{type:undefined,decorators:[{type:s.Inject,args:[L]}]},{type:undefined,decorators:[{type:s.Inject,args:[d.STORAGE_CONFIG_TOKEN]}]}]},b([o.BindObservable(),T("design:type",N)],P.prototype,"current",void 0),P);function P(t,e){this._customEntitiesListFiltersModalConfig=t,this._storage=e,this.current=undefined,this.storageKeyName="custom-entities-list-filters-modal",this.current=this.getDefault()}var D,R=(M(A,D=d.BasePromptFormModalComponent),A.prototype.ngOnInit=function(){this.data=this._customEntitiesListFiltersModalService.getCurrent(),this.hideYes=!0},A.prototype.onYesClick=function(t){this._customEntitiesListFiltersModalService.setCurrent(this.data),D.prototype.onYesClick.call(this,t)},A.decorators=[{type:s.Component,args:[{selector:"custom-entities-list-filters-modal",template:'<prompt-form-modal\n  [bindIO]\n  iconTopYes="checkmark"\n  iconTopNo="close"\n  [hideFooter]="true"\n>\n</prompt-form-modal>\n<ion-content padding-top>\n  <prompt-form-modal [bindIO] [hideHeader]="true">\n    <form [formGroup]="form" novalidate>\n      <form-group [bindIO] name="sortField" [title]="strings.sortField">\n        <select-input\n          [items]="sortFields"\n          formControlName="sortField"\n          [disableControl]="readonly"\n        >\n        </select-input>\n      </form-group>\n      <form-group [bindIO] name="sortType" [title]="strings.sortType">\n        <select-input\n          [items]="sortTypes"\n          formControlName="sortType"\n          [disableControl]="readonly"\n        >\n        </select-input>\n      </form-group>\n    </form>\n  </prompt-form-modal>\n</ion-content>\n',changeDetection:s.ChangeDetectionStrategy.OnPush}]}],A.ctorParameters=function(){return[{type:w}]},A.propDecorators={"class":[{type:s.Input}]},A=b([m.BindIoInner(),T("design:paramtypes",[w])],A));function A(t){var e=D.call(this)||this;return e._customEntitiesListFiltersModalService=t,e["class"]=undefined,e.sortTypes=N.sortTypes,e.sortFields=N.sortFields,e.group(N),e}var G,j=(M(U,G=d.BaseEntityListComponent),U.prototype.ngOnInit=function(){this.mockedItems||this.useRest(v({apiUrl:this.apiUrl,infinity:!0},this.customEntitiesConfig,{autoload:!1})),this.mockedItems&&this.useMock(v({items:this.mockedItems,infinity:!0},this.customEntitiesConfig,{autoload:!1})),this.onChangeFilter()},U.prototype.setSearchText=function(t){this.list.searchField.setValue(t.detail.value)},U.prototype.onDeleteClickAsync=function(r){return F(this,void 0,void 0,function(){var e,o,n=this;return O(this,function(t){switch(t.label){case 0:e=d.interpolate(this.translateService.instant(this.strings.deleteTitle),r),o=d.interpolate(this.translateService.instant(this.strings.deleteMessage),r),t.label=1;case 1:return t.trys.push([1,3,,4]),[4,this.modalsService.confirmAsync({title:e,message:o})];case 2:return t.sent()&&this.repository["delete"](r.id).subscribe(function(t){n.mockedItems&&(n.mockedItems=n.repository.items,n.mockedItemsChange.emit(n.mockedItems))},function(t){return n.onError(t)}),[3,4];case 3:throw t.sent();case 4:return[2]}})})},U.prototype.createFiltersModal=function(o){return F(this,void 0,void 0,function(){var e;return O(this,function(t){switch(t.label){case 0:return o=o||new N,[4,this.modalsService.createAsync(R,{"class":"secondary",initialState:{title:d.translate("Custom entities filters"),data:o}})];case 1:return(e=t.sent()).instance.group(N),e.instance.data=o,[2,e]}})})},U.prototype.onFilterClickAsync=function(o){return F(this,void 0,void 0,function(){var e=this;return O(this,function(t){switch(t.label){case 0:return[4,this.createFiltersModal(o)];case 1:return t.sent().instance.yes.subscribe(function(t){t.hide(),e.onChangeFilter()}),[2]}})})},U.prototype.onFilterClick=function(t){this.onFilterClickAsync(t).then()},U.prototype.onChangeFilter=function(t){t||(t={});var e=this._customEntitiesListFiltersModalService.getCurrent();e.sortField&&(t.sort=e.sortField.id),e.sortType&&(t.sort=("asc"===e.sortType.id?"":"-")+t.sort),G.prototype.onChangeFilter.call(this,t)},U.prototype.onUpdateClickAsync=function(i){return F(this,void 0,void 0,function(){var e,o,n,r=this;return O(this,function(t){switch(t.label){case 0:return(e=this.modalUpdate.component||this.modalItem.component)?[3,2]:[4,this.createUpdateModal(i)];case 1:return n=t.sent(),[3,3];case 2:n=undefined,t.label=3;case 3:return(o=n)?[3,5]:[4,this.defaultCreateUpdateModal(i)];case 4:o=t.sent(),s.isDevMode()&&!e&&console.warn('Method "createUpdateModal" is not defined',this),t.label=5;case 5:return o.instance.yes.subscribe(function(e){e.processing=!0,r.repository.update(i.id,e.getData()).subscribe(function(t){e.processing=!1,r.mockedItems&&(r.mockedItems=r.repository.items,r.mockedItemsChange.emit(r.mockedItems)),e.hide()},function(t){return r.onUpdateError(e,t)})}),[2]}})})},U.decorators=[{type:s.Component,args:[{selector:"custom-entities-list",template:"<entity-list\n  [bindIO]\n  [items]=\"items$ | async\"\n  [columns]=\"['title', 'name', 'action']\"\n  [enableCreate]=\"'add_custom-entity' | perm: false | async\"\n  [enableUpdate]=\"'change_custom-entity' | perm: false | async\"\n  [enableDelete]=\"'delete_custom-entity' | perm: false | async\"\n  #list\n>\n  <ng-content></ng-content>\n</entity-list>\n",changeDetection:s.ChangeDetectionStrategy.OnPush}]}],U.ctorParameters=function(){return[{type:d.ModalsService},{type:d.ErrorsExtractor},{type:c.TranslateService},{type:e.DynamicRepository},{type:undefined,decorators:[{type:s.Inject,args:[a.CUSTOM_ENTITIES_CONFIG_TOKEN]}]},{type:w}]},U.propDecorators={list:[{type:s.ViewChild,args:["list"]}],modalItem:[{type:s.Input}],modalView:[{type:s.Input}],title:[{type:s.Input}]},U=b([m.BindIoInner(),T("design:paramtypes",[d.ModalsService,d.ErrorsExtractor,c.TranslateService,e.DynamicRepository,Object,w])],U));function U(t,e,o,n,r,i){var s=G.call(this,n.fork(a.CustomEntity),t,a.CustomEntity)||this;return s.errorsExtractor=e,s.translateService=o,s.dynamicRepository=n,s.customEntitiesConfig=r,s._customEntitiesListFiltersModalService=i,s.modalItem={"class":"primary",component:S,initialState:{hideYes:!0,hideNo:!0}},s.modalView={"class":"medium",component:S,initialState:{noClass:"medium",hideYes:!0,hideNo:!0}},s.title=d.translate("Custom entities"),s}var q=(B.decorators=[{type:s.NgModule,args:[{imports:[i.CommonModule,u.IonicModule,p.FormGroupModule,l.ReactiveFormsModule,c.TranslateModule.forChild(),d.DirectivesModule,d.PipesModule,p.PromptFormModalModule,p.SelectInputModule,m.NgxBindIOModule],declarations:[S],entryComponents:[S],exports:[S,p.FormGroupModule]}]}],B);function B(){}var K=(V.forRoot=function(t){return{ngModule:V,providers:[{provide:L,useValue:{sortField:t&&t.sortField?t.sortField:x.sortField,sortType:t&&t.sortType?t.sortType:x.sortType}},w]}},V.decorators=[{type:s.NgModule,args:[{imports:[i.CommonModule,u.IonicModule,p.FormGroupModule,l.ReactiveFormsModule,c.TranslateModule.forChild(),d.DirectivesModule,d.PipesModule,p.PromptFormModalModule,p.SelectInputModule,m.NgxBindIOModule],declarations:[R],entryComponents:[R],exports:[R,p.FormGroupModule]}]}],V);function V(){}var Y=(z.decorators=[{type:s.NgModule,args:[{imports:[i.CommonModule,u.IonicModule,p.IonicModalsModule,c.TranslateModule.forChild(),d.PipesModule,p.EntityListModule,q,K,n.RouterModule,m.NgxBindIOModule],declarations:[j],exports:[j]}]}],z);function z(){}t.RuI18n=f,t.CustomOrgCustomLibIonicModule=h,t.CustomEntitiesListComponent=j,t.CustomEntitiesListModule=Y,t.CustomEntitiesListFiltersModalComponent=R,t.DEFAULT_CUSTOM_ENTITIES_LIST_FILTERS_MODAL_CONFIG=x,t.CUSTOM_ENTITIES_LIST_FILTERS_MODAL_CONFIG_TOKEN=L,t.CustomEntitiesListFiltersModalModule=K,t.customEntitiesListFiltersModalServiceInitializeApp=function $(t){return function(){return t.initializeApp()}},t.CustomEntitiesListFiltersModalService=w,t.CustomEntitiesListFiltersModal=N,t.CustomEntityModalComponent=S,t.CustomEntityModalModule=q,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=custom-org-custom-lib-ionic.umd.min.js.map
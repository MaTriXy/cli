!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("ngx-repository"),require("@custom-org/custom-lib"),require("bind-observable"),require("class-transformer"),require("@angular/router"),require("@angular/common"),require("@angular/core"),require("@angular/forms"),require("@ionic/angular"),require("@ngx-translate/core"),require("@rucken/core"),require("@rucken/ionic"),require("ngx-bind-io")):"function"==typeof define&&define.amd?define("@custom-org/custom-lib-ionic",["exports","ngx-repository","@custom-org/custom-lib","bind-observable","class-transformer","@angular/router","@angular/common","@angular/core","@angular/forms","@ionic/angular","@ngx-translate/core","@rucken/core","@rucken/ionic","ngx-bind-io"],e):e((t["custom-org"]=t["custom-org"]||{},t["custom-org"]["custom-lib-ionic"]={}),t.ngxRepository,t.customLib,t.bindObservable,t.classTransformer,t.ng.router,t.ng.common,t.ng.core,t.ng.forms,t.angular,t.core$1,t.core$2,t.ionic,t.ngxBindIo)}(this,function(t,e,l,n,r,o,i,s,a,u,c,d,p,m){"use strict";var f={},y={title:d.translate("Russian"),code:"ru",translations:[f]},g={title:d.translate("English"),code:"en",translations:[]},h=function(){function t(){}return t.decorators=[{type:s.NgModule,args:[{imports:[i.CommonModule],providers:[{provide:d.LANGUAGES_ITEM_CONFIG_TOKEN,useValue:y,multi:!0},{provide:d.LANGUAGES_ITEM_CONFIG_TOKEN,useValue:g,multi:!0}]}]}],t}(),C=function(t,e){return(C=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function I(t,e){function n(){this.constructor=t}C(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var M=function(){return(M=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)};function b(t,e,n,o){var r,i=arguments.length,s=i<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,o);else for(var a=t.length-1;0<=a;a--)(r=t[a])&&(s=(i<3?r(s):3<i?r(e,n,s):r(e,n))||s);return 3<i&&s&&Object.defineProperty(e,n,s),s}function v(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)}function T(e,s,a,l){return new(a||(a=Promise))(function(t,n){function o(t){try{i(l.next(t))}catch(e){n(e)}}function r(t){try{i(l["throw"](t))}catch(e){n(e)}}function i(e){e.done?t(e.value):new a(function(t){t(e.value)}).then(o,r)}i((l=l.apply(e,s||[])).next())})}function F(o,r){var i,s,a,t,l={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return t={next:e(0),"throw":e(1),"return":e(2)},"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function n(t){if(i)throw new TypeError("Generator is already executing.");for(;l;)try{if(i=1,s&&(a=2&t[0]?s["return"]:t[0]?s["throw"]||((a=s["return"])&&a.call(s),0):s.next)&&!(a=a.call(s,t[1])).done)return a;switch(s=0,a&&(t=[2&t[0],a.value]),t[0]){case 0:case 1:a=t;break;case 4:return l.label++,{value:t[1],done:!1};case 5:l.label++,s=t[1],t=[0];continue;case 7:t=l.ops.pop(),l.trys.pop();continue;default:if(!(a=0<(a=l.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){l=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){l.label=t[1];break}if(6===t[0]&&l.label<a[1]){l.label=a[1],a=t;break}if(a&&l.label<a[2]){l.label=a[2],l.ops.push(t);break}a[2]&&l.ops.pop(),l.trys.pop();continue}t=r.call(o,l)}catch(e){t=[6,e],s=0}finally{i=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([e,t])}}}var O=function(e){function t(){var t=e.call(this)||this;return t["class"]=undefined,t.group(l.CustomEntity),t}return I(t,e),t.decorators=[{type:s.Component,args:[{selector:"custom-entity-modal",template:'<prompt-form-modal\n  [bindIO]\n  [iconTopYes]="data.id ? \'checkmark\' : \'add\'"\n  [hideFooter]="true"\n>\n</prompt-form-modal>\n<ion-content padding-top [class.readonly_content]="readonly">\n  <prompt-form-modal [bindIO] [hideHeader]="true">\n    <form [formGroup]="form" novalidate>\n      <form-group [bindIO] name="title" [title]="strings.title">\n        <ion-input\n          formControlName="title"\n          [disableControl]="readonly"\n          [autofocus]="true"\n        >\n        </ion-input>\n      </form-group>\n      <form-group [bindIO] name="name" [title]="strings.name">\n        <ion-textarea formControlName="name" [disableControl]="readonly">\n        </ion-textarea>\n      </form-group>\n    </form>\n  </prompt-form-modal>\n</ion-content>\n',changeDetection:s.ChangeDetectionStrategy.OnPush}]}],t.ctorParameters=function(){return[]},t.propDecorators={"class":[{type:s.Input}]},t=b([m.BindIoInner(),v("design:paramtypes",[])],t)}(d.BasePromptFormModalComponent),E=function(){function t(){this.id=undefined,this.sortField=undefined,this.sortType=undefined}return t.strings={sortField:d.translate("Sort field"),sortType:d.translate("Sort type")},t.sortFields=[{id:"id",title:d.translate("Id")},{id:"title",title:d.translate("Title")}],t.sortTypes=[{id:"asc",title:d.translate("Asc")},{id:"desc",title:d.translate("Desc")}],b([r.Type(d.serializeModel(p.SelectInput)),r.Transform(p.keyToSelectInput({items:t.sortFields}),{toClassOnly:!0,groups:["manual"]}),r.Transform(p.selectInputToKey({items:t.sortFields}),{toPlainOnly:!0,groups:["manual"]}),v("design:type",p.SelectInput)],t.prototype,"sortField",void 0),b([r.Type(d.serializeModel(p.SelectInput)),r.Transform(p.keyToSelectInput({items:t.sortTypes}),{toClassOnly:!0,groups:["manual"]}),r.Transform(p.selectInputToKey({items:t.sortTypes}),{toPlainOnly:!0,groups:["manual"]}),v("design:type",p.SelectInput)],t.prototype,"sortType",void 0),t}(),S={sortField:"id",sortType:"desc"},_="CustomEntitiesListFiltersModalConfig";var N=function(){function t(t,e){this._customEntitiesListFiltersModalConfig=t,this._storage=e,this.current=undefined,this.storageKeyName="custom-entities-list-filters-modal",this.current=this.getDefault()}return t.prototype.getDefault=function(){return r.plainToClass(E,M({},S,this._customEntitiesListFiltersModalConfig),{groups:["manual"]})},t.prototype.getCurrent=function(){return this.current},t.prototype.setCurrent=function(e){var n=this;this._storage.setItem(this.storageKeyName,JSON.stringify(r.classToPlain(e||this.getDefault(),{groups:["manual"]}))).then(function(t){return n.current=e})},t.prototype.initCurrent=function(){var o=this;return new Promise(function(n){o._storage.getItem(o.storageKeyName).then(function(t){if(t&&"undefined"!==t)try{n(r.plainToClass(E,JSON.parse(t),{groups:["manual"]}))}catch(e){n(o.getCurrent())}else n(o.getCurrent())})})},t.prototype.initializeApp=function(){var n=this;return new Promise(function(e){n.initCurrent().then(function(t){n.setCurrent(t),e()})})},t.decorators=[{type:s.Injectable}],t.ctorParameters=function(){return[{type:undefined,decorators:[{type:s.Inject,args:[_]}]},{type:undefined,decorators:[{type:s.Inject,args:[d.STORAGE_CONFIG_TOKEN]}]}]},b([n.BindObservable(),v("design:type",E)],t.prototype,"current",void 0),t}(),k=function(n){function t(t){var e=n.call(this)||this;return e._customEntitiesListFiltersModalService=t,e["class"]=undefined,e.sortTypes=E.sortTypes,e.sortFields=E.sortFields,e.group(E),e}return I(t,n),t.prototype.ngOnInit=function(){this.data=this._customEntitiesListFiltersModalService.getCurrent(),this.hideYes=!0},t.prototype.onYesClick=function(t){this._customEntitiesListFiltersModalService.setCurrent(this.data),n.prototype.onYesClick.call(this,t)},t.decorators=[{type:s.Component,args:[{selector:"custom-entities-list-filters-modal",template:'<prompt-form-modal\n  [bindIO]\n  iconTopYes="checkmark"\n  iconTopNo="close"\n  [hideFooter]="true"\n>\n</prompt-form-modal>\n<ion-content padding-top>\n  <prompt-form-modal [bindIO] [hideHeader]="true">\n    <form [formGroup]="form" novalidate>\n      <form-group [bindIO] name="sortField" [title]="strings.sortField">\n        <select-input\n          [items]="sortFields"\n          formControlName="sortField"\n          [disableControl]="readonly"\n        >\n        </select-input>\n      </form-group>\n      <form-group [bindIO] name="sortType" [title]="strings.sortType">\n        <select-input\n          [items]="sortTypes"\n          formControlName="sortType"\n          [disableControl]="readonly"\n        >\n        </select-input>\n      </form-group>\n    </form>\n  </prompt-form-modal>\n</ion-content>\n',changeDetection:s.ChangeDetectionStrategy.OnPush}]}],t.ctorParameters=function(){return[{type:N}]},t.propDecorators={"class":[{type:s.Input}]},t=b([m.BindIoInner(),v("design:paramtypes",[N])],t)}(d.BasePromptFormModalComponent),x=function(a){function t(t,e,n,o,r,i){var s=a.call(this,o.fork(l.CustomEntity),t,l.CustomEntity)||this;return s.errorsExtractor=e,s.translateService=n,s.dynamicRepository=o,s.customEntitiesConfig=r,s._customEntitiesListFiltersModalService=i,s.modalItem={"class":"primary",component:O,initialState:{hideYes:!0,hideNo:!0}},s.modalView={"class":"medium",component:O,initialState:{noClass:"medium",hideYes:!0,hideNo:!0}},s.title=d.translate("Custom entities"),s}return I(t,a),t.prototype.ngOnInit=function(){this.mockedItems||this.useRest(M({apiUrl:this.apiUrl,infinity:!0},this.customEntitiesConfig,{autoload:!1})),this.mockedItems&&this.useMock(M({items:this.mockedItems,infinity:!0},this.customEntitiesConfig,{autoload:!1})),this.onChangeFilter()},t.prototype.setSearchText=function(t){this.list.searchField.setValue(t.detail.value)},t.prototype.onDeleteClickAsync=function(r){return T(this,void 0,void 0,function(){var e,n,o=this;return F(this,function(t){switch(t.label){case 0:e=d.interpolate(this.translateService.instant(this.strings.deleteTitle),r),n=d.interpolate(this.translateService.instant(this.strings.deleteMessage),r),t.label=1;case 1:return t.trys.push([1,3,,4]),[4,this.modalsService.confirmAsync({title:e,message:n})];case 2:return t.sent()&&this.repository["delete"](r.id).subscribe(function(t){o.mockedItems&&(o.mockedItems=o.repository.items,o.mockedItemsChange.emit(o.mockedItems))},function(t){return o.onError(t)}),[3,4];case 3:throw t.sent();case 4:return[2]}})})},t.prototype.createFiltersModal=function(n){return T(this,void 0,void 0,function(){var e;return F(this,function(t){switch(t.label){case 0:return n=n||new E,[4,this.modalsService.createAsync(k,{"class":"secondary",initialState:{title:d.translate("Custom entities filters"),data:n}})];case 1:return(e=t.sent()).instance.group(E),e.instance.data=n,[2,e]}})})},t.prototype.onFilterClickAsync=function(n){return T(this,void 0,void 0,function(){var e=this;return F(this,function(t){switch(t.label){case 0:return[4,this.createFiltersModal(n)];case 1:return t.sent().instance.yes.subscribe(function(t){t.hide(),e.onChangeFilter()}),[2]}})})},t.prototype.onFilterClick=function(t){this.onFilterClickAsync(t).then()},t.prototype.onChangeFilter=function(t){t||(t={});var e=this._customEntitiesListFiltersModalService.getCurrent();e.sortField&&(t.sort=e.sortField.id),e.sortType&&(t.sort=("asc"===e.sortType.id?"":"-")+t.sort),a.prototype.onChangeFilter.call(this,t)},t.prototype.onUpdateClickAsync=function(i){return T(this,void 0,void 0,function(){var e,n,o,r=this;return F(this,function(t){switch(t.label){case 0:return(e=this.modalUpdate.component||this.modalItem.component)?[3,2]:[4,this.createUpdateModal(i)];case 1:return o=t.sent(),[3,3];case 2:o=undefined,t.label=3;case 3:return(n=o)?[3,5]:[4,this.defaultCreateUpdateModal(i)];case 4:n=t.sent(),s.isDevMode()&&!e&&console.warn('Method "createUpdateModal" is not defined',this),t.label=5;case 5:return n.instance.yes.subscribe(function(e){e.processing=!0,r.repository.update(i.id,e.getData()).subscribe(function(t){e.processing=!1,r.mockedItems&&(r.mockedItems=r.repository.items,r.mockedItemsChange.emit(r.mockedItems)),e.hide()},function(t){return r.onUpdateError(e,t)})}),[2]}})})},t.decorators=[{type:s.Component,args:[{selector:"custom-entities-list",template:"<entity-list\n  [bindIO]\n  [items]=\"items$ | async\"\n  [columns]=\"['title', 'name', 'action']\"\n  [enableCreate]=\"'add_custom-entity' | perm: false | async\"\n  [enableUpdate]=\"'change_custom-entity' | perm: false | async\"\n  [enableDelete]=\"'delete_custom-entity' | perm: false | async\"\n  #list\n>\n  <ng-content></ng-content>\n</entity-list>\n",changeDetection:s.ChangeDetectionStrategy.OnPush}]}],t.ctorParameters=function(){return[{type:d.ModalsService},{type:d.ErrorsExtractor},{type:c.TranslateService},{type:e.DynamicRepository},{type:undefined,decorators:[{type:s.Inject,args:[l.CUSTOM_ENTITIES_CONFIG_TOKEN]}]},{type:N}]},t.propDecorators={list:[{type:s.ViewChild,args:["list"]}],modalItem:[{type:s.Input}],modalView:[{type:s.Input}],title:[{type:s.Input}]},t=b([m.BindIoInner(),v("design:paramtypes",[d.ModalsService,d.ErrorsExtractor,c.TranslateService,e.DynamicRepository,Object,N])],t)}(d.BaseEntityListComponent),L=function(){function t(){}return t.decorators=[{type:s.NgModule,args:[{imports:[i.CommonModule,u.IonicModule,p.FormGroupModule,a.ReactiveFormsModule,c.TranslateModule.forChild(),d.DirectivesModule,d.PipesModule,p.PromptFormModalModule,p.SelectInputModule,m.NgxBindIOModule],declarations:[O],entryComponents:[O],exports:[O,p.FormGroupModule]}]}],t}(),w=function(){function e(){}return e.forRoot=function(t){return{ngModule:e,providers:[{provide:_,useValue:{sortField:t&&t.sortField?t.sortField:S.sortField,sortType:t&&t.sortType?t.sortType:S.sortType}},N]}},e.decorators=[{type:s.NgModule,args:[{imports:[i.CommonModule,u.IonicModule,p.FormGroupModule,a.ReactiveFormsModule,c.TranslateModule.forChild(),d.DirectivesModule,d.PipesModule,p.PromptFormModalModule,p.SelectInputModule,m.NgxBindIOModule],declarations:[k],entryComponents:[k],exports:[k,p.FormGroupModule]}]}],e}(),P=function(){function t(){}return t.decorators=[{type:s.NgModule,args:[{imports:[i.CommonModule,u.IonicModule,p.IonicModalsModule,c.TranslateModule.forChild(),d.PipesModule,p.EntityListModule,L,w,o.RouterModule,m.NgxBindIOModule],declarations:[x],exports:[x]}]}],t}();t.RuI18n=f,t.CustomOrgCustomLibIonicModule=h,t.CustomEntitiesListComponent=x,t.CustomEntitiesListModule=P,t.CustomEntitiesListFiltersModalComponent=k,t.DEFAULT_CUSTOM_ENTITIES_LIST_FILTERS_MODAL_CONFIG=S,t.CUSTOM_ENTITIES_LIST_FILTERS_MODAL_CONFIG_TOKEN=_,t.CustomEntitiesListFiltersModalModule=w,t.customEntitiesListFiltersModalServiceInitializeApp=function D(t){return function(){return t.initializeApp()}},t.CustomEntitiesListFiltersModalService=N,t.CustomEntitiesListFiltersModal=E,t.CustomEntityModalComponent=O,t.CustomEntityModalModule=L,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=custom-org-custom-lib-ionic.umd.min.js.map